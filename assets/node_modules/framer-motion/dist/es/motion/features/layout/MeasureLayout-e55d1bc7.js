import{frame as m}from"../../../frameloop/index-0bf9a1a0.js";import d,{r as p}from"../../../../../../react/index-4878784d.js";import{usePresence as c}from"../../../components/AnimatePresence/use-presence-11431ec2.js";import{LayoutGroupContext as f}from"../../../context/LayoutGroupContext-e3eb1a86.js";import{SwitchLayoutGroupContext as l}from"../../../context/SwitchLayoutGroupContext-24684617.js";import{globalProjectionState as h}from"../../../projection/node/state-2122229d.js";import{correctBorderRadius as n}from"../../../projection/styles/scale-border-radius-75522e18.js";import{correctBoxShadow as R}from"../../../projection/styles/scale-box-shadow-f4084157.js";import{addScaleCorrector as g}from"../../../projection/styles/scale-correction-f2b973ef.js";class y extends d.Component{componentDidMount(){const{visualElement:e,layoutGroup:o,switchLayoutGroup:t,layoutId:s}=this.props,{projection:r}=e;g(v),r&&(o.group&&o.group.add(r),t&&t.register&&s&&t.register(r),r.root.didUpdate(),r.addEventListener("animationComplete",()=>{this.safeToRemove()}),r.setOptions({...r.options,onExitComplete:()=>this.safeToRemove()})),h.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:o,visualElement:t,drag:s,isPresent:r}=this.props,i=t.projection;return i&&(i.isPresent=r,s||e.layoutDependency!==o||o===void 0?i.willUpdate():this.safeToRemove(),e.isPresent!==r&&(r?i.promote():i.relegate()||m.postRender(()=>{const u=i.getStack();(!u||!u.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),queueMicrotask(()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:e,layoutGroup:o,switchLayoutGroup:t}=this.props,{projection:s}=e;s&&(s.scheduleCheckAfterUnmount(),o&&o.group&&o.group.remove(s),t&&t.deregister&&t.deregister(s))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}function w(a){const[e,o]=c(),t=p.useContext(f);return d.createElement(y,{...a,layoutGroup:t,switchLayoutGroup:p.useContext(l),isPresent:e,safeToRemove:o})}const v={borderRadius:{...n,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:n,borderTopRightRadius:n,borderBottomLeftRadius:n,borderBottomRightRadius:n,boxShadow:R};export{w as MeasureLayout};
