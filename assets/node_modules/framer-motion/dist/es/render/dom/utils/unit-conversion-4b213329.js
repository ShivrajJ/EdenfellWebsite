import{isKeyframesTarget as K}from"../../../animation/utils/is-keyframes-target-051035e7.js";import{invariant as C}from"../../../utils/errors-1c110e5d.js";import{transformPropOrder as O}from"../../html/utils/transform-f683e7d2.js";import{findDimensionValueType as h}from"../value-types/dimensions-d49229e1.js";import{isBrowser as P}from"../../../utils/is-browser-b2773713.js";import{number as B}from"../../../value/types/numbers/index-2b97ffe1.js";import{px as w}from"../../../value/types/numbers/units-19d2ad6d.js";const S=new Set(["width","height","top","left","right","bottom","x","y","translateX","translateY"]),y=o=>S.has(o),j=o=>Object.keys(o).some(y),g=o=>o===B||o===w,b=(o,e)=>parseFloat(o.split(", ")[e]),V=(o,e)=>(s,{transform:t})=>{if(t==="none"||!t)return 0;const p=t.match(/^matrix3d\((.+)\)$/);if(p)return b(p[1],e);{const f=t.match(/^matrix\((.+)\)$/);return f?b(f[1],o):0}},v=new Set(["x","y","z"]),A=O.filter(o=>!v.has(o));function Y(o){const e=[];return A.forEach(s=>{const t=o.getValue(s);t!==void 0&&(e.push([s,t.get()]),t.set(s.startsWith("scale")?1:0))}),e.length&&o.render(),e}const F={width:({x:o},{paddingLeft:e="0",paddingRight:s="0"})=>o.max-o.min-parseFloat(e)-parseFloat(s),height:({y:o},{paddingTop:e="0",paddingBottom:s="0"})=>o.max-o.min-parseFloat(e)-parseFloat(s),top:(o,{top:e})=>parseFloat(e),left:(o,{left:e})=>parseFloat(e),bottom:({y:o},{top:e})=>parseFloat(e)+(o.max-o.min),right:({x:o},{left:e})=>parseFloat(e)+(o.max-o.min),x:V(4,13),y:V(5,14)},_=(o,e,s)=>{const t=e.measureViewportBox(),p=e.current,f=getComputedStyle(p),{display:d}=f,m={};d==="none"&&e.setStaticValue("display",o.display||"block"),s.forEach(a=>{m[a]=F[a](t,f)}),e.render();const r=e.measureViewportBox();return s.forEach(a=>{const i=e.getValue(a);i&&i.jump(m[a]),o[a]=F[a](r,f)}),o},M=(o,e,s={},t={})=>{e={...e},t={...t};const p=Object.keys(e).filter(y);let f=[],d=!1;const m=[];if(p.forEach(r=>{const a=o.getValue(r);if(!o.hasValue(r))return;let i=s[r],c=h(i);const n=e[r];let l;if(K(n)){const x=n.length,T=n[0]===null?1:0;i=n[T],c=h(i);for(let u=T;u<x&&n[u]!==null;u++)l?C(h(n[u])===l):l=h(n[u])}else l=h(n);if(c!==l)if(g(c)&&g(l)){const x=a.get();typeof x=="string"&&a.set(parseFloat(x)),typeof n=="string"?e[r]=parseFloat(n):Array.isArray(n)&&l===w&&(e[r]=n.map(parseFloat))}else c!=null&&c.transform&&(l!=null&&l.transform)&&(i===0||n===0)?i===0?a.set(l.transform(i)):e[r]=c.transform(n):(d||(f=Y(o),d=!0),m.push(r),t[r]=t[r]!==void 0?t[r]:e[r],a.jump(n))}),m.length){const r=m.indexOf("height")>=0?window.pageYOffset:null,a=_(e,o,m);return f.length&&f.forEach(([i,c])=>{o.getValue(i).set(c)}),o.render(),P&&r!==null&&window.scrollTo({top:r}),{target:a,transitionEnd:t}}else return{target:e,transitionEnd:t}};function X(o,e,s,t){return j(e)?M(o,e,s,t):{target:e,transitionEnd:t}}export{F as positionalValues,X as unitConversion};
