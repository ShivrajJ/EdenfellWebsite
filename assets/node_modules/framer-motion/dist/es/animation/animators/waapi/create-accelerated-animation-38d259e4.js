import{cancelFrame as k,frame as w}from"../../../frameloop/index-0bf9a1a0.js";import{animateStyle as F}from"./index-e5489823.js";import{isWaapiSupportedEasing as b}from"./easing-d2fb40fa.js";import{supports as D}from"./supports-cab8bf8c.js";import{getFinalKeyframe as K}from"./utils/get-final-keyframe-6faae244.js";import{animateValue as S}from"../js/index-8640110f.js";import{millisecondsToSeconds as T,secondsToMilliseconds as V}from"../../../utils/time-conversion-2fe207ba.js";const x=new Set(["opacity","clipPath","filter","transform","backgroundColor"]),l=10,C=2e4,R=(i,n)=>n.type==="spring"||i==="backgroundColor"||!b(n.ease);function G(i,n,{onUpdate:W,onComplete:p,...a}){if(!(D.waapi()&&x.has(n)&&!a.repeatDelay&&a.repeatType!=="mirror"&&a.damping!==0&&a.type!=="inertia"))return!1;let u=!1,d,f;const y=()=>{f=new Promise(e=>{d=e})};y();let{keyframes:s,duration:o=300,ease:h,times:g}=a;if(R(n,a)){const e=S({...a,repeat:0,delay:0});let r={done:!1,value:s[0]};const P=[];let c=0;for(;!r.done&&c<C;)r=e.sample(c),P.push(r.value),c+=l;g=void 0,s=P,o=c-l,h="linear"}const t=F(i.owner.current,n,s,{...a,duration:o,ease:h,times:g}),A=()=>t.cancel(),m=()=>{w.update(A),d(),y()};return t.onfinish=()=>{i.set(K(s,a)),p&&p(),m()},{then(e,r){return f.then(e,r)},get time(){return T(t.currentTime||0)},set time(e){t.currentTime=V(e)},get speed(){return t.playbackRate},set speed(e){t.playbackRate=e},get duration(){return T(o)},play:()=>{u||(t.play(),k(A))},pause:()=>t.pause(),stop:()=>{if(u=!0,t.playState==="idle")return;const{currentTime:e}=t;if(e){const r=S({...a,autoplay:!1});i.setWithVelocity(r.sample(e-l).value,r.sample(e).value,l)}m()},complete:()=>t.finish(),cancel:m}}export{G as createAcceleratedAnimation};
