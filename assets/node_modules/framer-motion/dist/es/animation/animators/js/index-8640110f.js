import{keyframes as y}from"../../generators/keyframes-a3630e7c.js";import{spring as ee}from"../../generators/spring/index-bca8285b.js";import{inertia as T}from"../../generators/inertia-2278797d.js";import{frameloopDriver as te}from"./driver-frameloop-bd236aeb.js";import{interpolate as ie}from"../../../utils/interpolate-bb792e0b.js";import{clamp as ne}from"../../../utils/clamp-eab0e97e.js";import{millisecondsToSeconds as A,secondsToMilliseconds as re}from"../../../utils/time-conversion-2fe207ba.js";import{calcGeneratorDuration as X}from"../../generators/utils/calc-duration-21512f5a.js";const le={decay:T,inertia:T,tween:y,keyframes:y,spring:ee};function he({autoplay:Y=!0,delay:Z=0,driver:_=te,keyframes:u,type:C="keyframes",repeat:m=0,repeatDelay:d=0,repeatType:h="loop",onPlay:B,onStop:K,onComplete:N,onUpdate:O,...F}){let o=1,S=!1,I,V;const M=()=>{I&&I(),V=new Promise(e=>{I=e})};M();let r;const P=le[C]||y;let x;P!==y&&typeof u[0]!="number"&&(x=ie([0,100],u,{clamp:!1}),u=[0,100]);const s=P({...F,keyframes:u});let W;h==="mirror"&&(W=P({...F,keyframes:[...u].reverse(),velocity:-(F.velocity||0)}));let i="idle",l=null,n=null,p=null;s.calculatedDuration===null&&m&&(s.calculatedDuration=X(s));const{calculatedDuration:G}=s;let f=1/0,v=1/0;G!==null&&(f=G+d,v=f*(m+1)-d);let t=0;const b=e=>{if(n===null)return;o>0&&(n=Math.min(n,e)),l!==null?t=l:t=(e-n)*o;const g=t-Z,E=g<0;t=Math.max(g,0),i==="finished"&&l===null&&(t=v);let H=t,J=s;if(m){const k=t/f;let D=Math.floor(k),a=k%1;!a&&k>=1&&(a=1),a===1&&D--,D=Math.min(D,m+1);const Q=!!(D%2);Q&&(h==="reverse"?(a=1-a,d&&(a-=d/f)):h==="mirror"&&(J=W));let R=ne(0,1,a);t>v&&(R=h==="reverse"&&Q?1:0),H=R*f}const c=E?{done:!1,value:u[0]}:J.next(H);x&&(c.value=x(c.value));let{done:L}=c;!E&&G!==null&&(L=t>=v);const $=l===null&&(i==="finished"||i==="running"&&L||o<0&&t<=0);return O&&O(c.value),$&&U(),c},j=()=>{r&&r.stop(),r=void 0},q=()=>{i="idle",j(),M(),n=p=null},U=()=>{i="finished",N&&N(),j(),M()},w=()=>{if(S)return;r||(r=_(b));const e=r.now();B&&B(),l!==null?n=e-l:(!n||i==="finished")&&(n=e),p=n,l=null,i="running",r.start()};Y&&w();const z={then(e,g){return V.then(e,g)},get time(){return A(t)},set time(e){e=re(e),t=e,l!==null||!r||o===0?l=e:n=r.now()-e/o},get duration(){const e=s.calculatedDuration===null?X(s):s.calculatedDuration;return A(e)},get speed(){return o},set speed(e){e===o||!r||(o=e,z.time=A(t))},get state(){return i},play:w,pause:()=>{i="paused",l=t},stop:()=>{S=!0,i!=="idle"&&(i="idle",K&&K(),q())},cancel:()=>{p!==null&&b(p),q()},complete:()=>{i="finished"},sample:e=>(n=0,b(e))};return z}export{he as animateValue};
